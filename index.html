<!DOCTYPE html>
<html>
<head>
	
	<title>Mandaue City - Covid Map Tracker</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />
	
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
	<link rel="stylesheet" href="style.css">
	
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.0/jquery.min.js" integrity="sha256-xNzN2a4ltkB44Mc/Jz3pT4iU1cmeR0FkXs4pru/JxaQ=" crossorigin="anonymous"></script>
	<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.2.1/moment.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
	<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

	<style>
	html, body {
		height: 100%;
		margin: 0;
	}
	#map { width: 100%; height: 800px; }
	.info { padding: 10px 14px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; border: 2px solid #4e4e4e; } 
	.info h4 { margin: 0 0 5px; color: #777; }
	.legend { text-align: left; line-height: 18px; color: #555; } 
	.legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }
	</style>
	
</head>
<body>

	<nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
	  <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Covid Tracker PH</a>
	  
	  <div id="topData" class="text-left col-md-9 py-3 p-md-0 text-white d-flex flex-column flex-md-row">
		<div class="mr-0 mr-md-3">Total PH Cases : <span class="topTotalCases font-weight-bold"></span> as of <span class="topLastUpdate font-weight-bold"></span></div>
		<div class="mr-0 mr-md-3">Deaths : <span class="topDeaths text-warning"></span></div>
		<div class="mr-0 mr-md-3">Recoveries : <span class="topRecoveries text-success"></span></div>
		<div class="mr-0 mr-md-3">Mandaue Cases : <span class="mandaueCases"></span></div>
		<div class="mr-0 mr-md-3">Cebu Cases : <span class="cebuCases"></span></div>
		<div class="mr-0 mr-md-3">Talisay Cases : <span class="talisayCases"></span></div>
	  </div>
	  
	  <ul class="navbar-nav px-3">
		<li class="nav-item text-nowrap">
			<a class="buy-me-a-coffee" data-toggle="tooltip" data-placement="bottom" title="Buy me a Coffee :)" href="https://www.buymeacoffee.com/jpedrosa" target="_blank">
				<img src="https://img.buymeacoffee.com/api/?name=Jessiemar+Pedrosa&size=300&bg-image=bmc" />
			</a>
		</li>
	  </ul>
	</nav>

	<div class="container-fluid">
      <div class="row">
	  
		<!------------------- Navigation Menu ------------------->
        <nav id="main-nav" class="col-md-2 d-none d-md-block bg-light sidebar">
          <div class="sidebar-sticky">
            <ul class="nav flex-column">
              <li class="nav-item">
                <a class="nav-link active" href="#">
                  <span data-feather="map"></span>
                  PH Covid Cases Map <span class="sr-only">(current)</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#covid-cases-overtime">
                  <span data-feather="bar-chart"></span>
                  PH Covid Cases Overtime
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#covid-cases-per-province">
                  <span data-feather="users"></span>
                  Covid Cases per Province
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="users"></span>
                  Customers
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="bar-chart-2"></span>
                  Reports
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#">
                  <span data-feather="layers"></span>
                  Integrations
                </a>
              </li>
            </ul>

          </div>
        </nav>

		<!------------------- Main Content ------------------>
        <main id="main" role="main" class="col-md-10 ml-sm-auto col-lg-10 pt-3 px-4">
          
			<!--- Mandaue Covid Map Tracker --->
			<div class="container-fluid">
			<div class="row">
				<div class="col-12 m-0 p-0">
					<div id='map'></div>
				</div>
			</div>
			</div>

			<hr class="my-5" />
			  
			<!--- Covid-19 Cases Overtime Graph --->
			<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pb-2 mb-3 border-bottom">
			<h2 class="h3">Covid-19 Cases Overtime Year 2020</h1>
			<div class="d-none btn-toolbar mb-2 mb-md-0">
			  <button class="btn btn-sm btn-outline-secondary dropdown-toggle">
				<span data-feather="calendar"></span>
				This week
			  </button>
			</div>
			</div>

			<div id="covid-cases-overtime">
			<canvas class="my-4" id="myChart" width="900" height="380"></canvas>
			</div>
			  
			<!--- Covid Cases per Province --->
			<div id="covid-cases-per-province">
			<h2>Top Cases on Specific Areas</h2>
			<div class="table-responsive">
			<table class="table table-striped table-sm">
			  <thead>
				<tr>
				  <th>#</th>
				  <th>Province/City</th>
				  <th>Cases</th>
				  <th>Died</th>
				  <th>Recoveries</th>
				  <th>Gender Comparison</th>
				</tr>
			  </thead>
			  <tbody>
				<tr>
				  <td>1,001</td>
				  <td>Lorem</td>
				  <td>ipsum</td>
				  <td>dolor</td>
				  <td>sit</td>
				  <td>sit</td>
				</tr>
				<tr>
				  <td>1,002</td>
				  <td>amet</td>
				  <td>consectetur</td>
				  <td>adipiscing</td>
				  <td>elit</td>
				  <td>elit</td>
				</tr>
			  </tbody>
			</table>
			</div>
			</div>
			
        </main>
      </div>
    </div>


<script type="text/javascript" src="mandaue-barangay.js"></script>
<script type="text/javascript" src="core.js"></script>

<!-- Icons -->
<script src="https://unpkg.com/feather-icons/dist/feather.min.js"></script>
<script>
  feather.replace()
</script>

<!-- Graphs -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.min.js"></script>
<script>
	var ctx = document.getElementById("myChart");
	var dohCases = 'https://coronavirus-ph-api.herokuapp.com/doh-data-drop';
	
	var dates = [], uniqueDates = [], countsPerDate = [];
	var casesCtr=0;
	
	$.getJSON(dohCases, function (data) {
		
		// will generate array with ['Monday', 'Tuesday', 'Wednesday']
		var labels = data.data.map(function(item) {
			var dateReported = item.date_reported;
			var date_string = moment(dateReported, "YYYY-MM-DD").format("MMMM DD YYYY");
			dates.push(dateReported);
			
			return date_string;
		});
		
		var dataset = data.data.map(function(item) {
			if (item.region_res == '7')
				return item.age;
		});
		
		// Gather unique dates and save to uniqueDates[]
		$.each(dates, function(i, el){
			if($.inArray(el, uniqueDates) === -1) uniqueDates.push(el);
		});
		
		  
		function getNumberOfCases(region){
			var countsPerDate = [];
			// Loop through uniqueDates Array, compare the date values to JSON data, once found make a counter and store it to countsPerDate[]
			for (i=0; i<uniqueDates.length; i++){
				casesCtr = 0;
				for (let key in data.data) {
					//console.log( data.data[key].region_res + ' --- ' + val)
					if (region != '') {
						if ( data.data[key].date_reported == uniqueDates[i] && data.data[key].region_res === region ) casesCtr++;
					} else {
						if ( data.data[key].date_reported == uniqueDates[i] ) casesCtr++;
					}
				}
				countsPerDate.push(casesCtr);		
			}
			
			return countsPerDate;
		}

		var myChart = new Chart(ctx, {
			type: 'line',
			data: {
			  labels: uniqueDates,
			  datasets: [{
				label: "Total PH Cases",
				data: getNumberOfCases(""),
				lineTension: 0.5,
				backgroundColor: 'transparent',
				borderColor: '#007bff',
				borderWidth: 1.5,
				pointBackgroundColor: '#007bff',
				pointRadius:3,
				pointHoverRadius:4
			  },{
				label: "NCR Cases",
				data: getNumberOfCases("NCR"),
				lineTension: 0.5,
				backgroundColor: 'transparent',
				borderColor: 'red',
				borderWidth: 1.5,
				pointBackgroundColor: 'red',
				pointRadius:3,
				pointHoverRadius:4
			  },{
				label: "Region 7 Cases",
				data: getNumberOfCases("7"),
				lineTension: 0.5,
				backgroundColor: 'transparent',
				borderColor: 'green',
				borderWidth: 1.5,
				pointBackgroundColor: 'green',
				pointRadius:3,
				pointHoverRadius:4
			  },{
				label: "Region 4A Cases",
				data: getNumberOfCases("4A"),
				lineTension: 0.5,
				backgroundColor: 'transparent',
				borderColor: 'orange',
				borderWidth: 1.5,
				pointBackgroundColor: 'orange',
				pointRadius:3,
				pointHoverRadius:4
			  }]
			},
			options: {
			  scales: {
				xAxes: [{
					type: 'time',
					time: {
						tooltipFormat:'MMM DD, YYYY',
						unit: 'day',
						//unitStepSize: 5,
						displayFormats: {
							day: 'MMM DD'
						}
					},
					ticks: {
						autoSkip: false,
						maxTicksLimit: 15,
						fontColor: '#000'
					  }
				}],
				yAxes: [{
				  ticks: {
					beginAtZero: false
				  },
				  scaleLabel: {
					display: true,
					labelString: "Number of Cases",
					fontColor: "green"
				  }
				}]
			  },
			  legend: {
				display: true,
			  }
			}
		});
		
	});

</script>


</body>
</html>
